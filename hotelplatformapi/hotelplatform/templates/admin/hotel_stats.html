{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Thá»‘ng kÃª KhÃ¡ch sáº¡n{% endblock %}

{% block content %}
<div class="module">
    <h2>Thá»‘ng kÃª Tá»•ng quan KhÃ¡ch sáº¡n</h2>
    
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
        
        <!-- Thá»‘ng kÃª phÃ²ng -->
        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
            <h3 style="color: #007bff; margin: 0 0 10px 0;">Thá»‘ng kÃª PhÃ²ng</h3>
            <div style="font-size: 24px; font-weight: bold; color: #333;">{{ total_rooms }}</div>
            <div style="color: #666; font-size: 14px;">Tá»•ng sá»‘ phÃ²ng</div>
            <div style="margin-top: 10px;">
                <div style="color: #28a745;">âœ“ Trá»‘ng: {{ available_rooms }}</div>
                <div style="color: #ffc107;">â³ ÄÃ£ Ä‘áº·t: {{ booked_rooms }}</div>
                <div style="color: #dc3545;">ğŸ  Äang sá»­ dá»¥ng: {{ occupied_rooms }}</div>
            </div>
        </div>

        <!-- Thá»‘ng kÃª Ä‘áº·t phÃ²ng -->
        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
            <h3 style="color: #28a745; margin: 0 0 10px 0;">Äáº·t phÃ²ng</h3>
            <div style="font-size: 24px; font-weight: bold; color: #333;">{{ bookings_today }}</div>
            <div style="color: #666; font-size: 14px;">Äáº·t phÃ²ng hÃ´m nay</div>
            <div style="margin-top: 10px;">
                <div style="color: #666;">Tá»•ng: {{ total_bookings }}</div>
            </div>
        </div>

        <!-- Thá»‘ng kÃª khÃ¡ch hÃ ng -->
        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h3 style="color: #ffc107; margin: 0 0 10px 0;">KhÃ¡ch hÃ ng</h3>
            <div style="font-size: 24px; font-weight: bold; color: #333;">{{ total_customers }}</div>
            <div style="color: #666; font-size: 14px;">Tá»•ng khÃ¡ch hÃ ng</div>
            <div style="margin-top: 10px;">
                <div style="color: #28a745;">ğŸ‘¥ Má»›i thÃ¡ng nÃ y: {{ new_customers_this_month }}</div>
            </div>
        </div>

        <!-- Thá»‘ng kÃª doanh thu -->
        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545;">
            <h3 style="color: #dc3545; margin: 0 0 10px 0;">Doanh thu</h3>
            <div style="font-size: 24px; font-weight: bold; color: #333;">{{ total_revenue|floatformat:0 }} VNÄ</div>
            <div style="color: #666; font-size: 14px;">Tá»•ng doanh thu</div>
            <div style="margin-top: 10px;">
                <div style="color: #28a745;">ğŸ’° ThÃ¡ng nÃ y: {{ revenue_this_month|floatformat:0 }} VNÄ</div>
            </div>
        </div>
    </div>

    <!-- Thá»‘ng kÃª khÃ¡ch hÃ ng theo loáº¡i -->
    <div class="module" style="margin-top: 30px;">
        <h3>Thá»‘ng kÃª KhÃ¡ch hÃ ng theo Loáº¡i</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Loáº¡i khÃ¡ch hÃ ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Sá»‘ lÆ°á»£ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Tá»•ng booking</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Tá»•ng chi tiÃªu</th>
                </tr>
            </thead>
            <tbody>
                {% for customer_type in customer_type_stats %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        {% if customer_type.customer_type == 'new' %}
                            ğŸ†• KhÃ¡ch hÃ ng má»›i
                        {% elif customer_type.customer_type == 'regular' %}
                            ğŸ‘¤ KhÃ¡ch phá»• thÃ´ng
                        {% elif customer_type.customer_type == 'vip' %}
                            â­ KhÃ¡ch VIP
                        {% elif customer_type.customer_type == 'super_vip' %}
                            ğŸ’ KhÃ¡ch siÃªu VIP
                        {% else %}
                            â“ KhÃ´ng xÃ¡c Ä‘á»‹nh
                        {% endif %}
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ customer_type.count }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ customer_type.total_bookings|default:"0" }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ customer_type.total_spent|floatformat:0|default:"0" }} VNÄ</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Thá»‘ng kÃª loáº¡i phÃ²ng -->
    <div class="module" style="margin-top: 30px;">
        <h3>Thá»‘ng kÃª theo Loáº¡i phÃ²ng</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Loáº¡i phÃ²ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Sá»‘ phÃ²ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">LÆ°á»£t Ä‘áº·t</th>
                </tr>
            </thead>
            <tbody>
                {% for room_type in room_type_stats %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ room_type.name }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ room_type.room_count }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ room_type.booking_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Thá»‘ng kÃª tráº¡ng thÃ¡i Ä‘áº·t phÃ²ng -->
    <div class="module" style="margin-top: 30px;">
        <h3>Thá»‘ng kÃª Tráº¡ng thÃ¡i Äáº·t phÃ²ng</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Tráº¡ng thÃ¡i</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Sá»‘ lÆ°á»£ng</th>
                </tr>
            </thead>
            <tbody>
                {% for status in booking_status_stats %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        {% if status.status == 'pending' %}
                            ğŸ”„ Chá» xÃ¡c nháº­n
                        {% elif status.status == 'confirmed' %}
                            âœ… ÄÃ£ xÃ¡c nháº­n
                        {% elif status.status == 'checked_in' %}
                            ğŸ  ÄÃ£ nháº­n phÃ²ng
                        {% elif status.status == 'checked_out' %}
                            ğŸšª ÄÃ£ tráº£ phÃ²ng
                        {% elif status.status == 'cancelled' %}
                            âŒ ÄÃ£ há»§y
                        {% elif status.status == 'no_show' %}
                            ğŸ‘» KhÃ´ng xuáº¥t hiá»‡n
                        {% else %}
                            {{ status.status }}
                        {% endif %}
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ status.count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
