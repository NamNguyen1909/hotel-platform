{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Th·ªëng k√™ Doanh thu{% endblock %}

{% block content %}
<div class="module">
    <h2>Th·ªëng k√™ Doanh thu {{ current_year }}</h2>
    
    <!-- Th·ªëng k√™ doanh thu theo th√°ng -->
    <div class="module" style="margin-top: 20px;">
        <h3>Doanh thu theo Th√°ng</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Th√°ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">Doanh thu (VNƒê)</th>
                </tr>
            </thead>
            <tbody>
                {% for month_data in monthly_revenue %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">Th√°ng {{ month_data.month }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">{{ month_data.total|floatformat:0 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="2" style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #666;">
                        Ch∆∞a c√≥ d·ªØ li·ªáu doanh thu
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Th·ªëng k√™ theo ph∆∞∆°ng th·ª©c thanh to√°n -->
    <div class="module" style="margin-top: 30px;">
        <h3>Th·ªëng k√™ theo Ph∆∞∆°ng th·ª©c Thanh to√°n</h3>
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
            {% for payment in payment_method_stats %}
            <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
                <h4 style="color: #007bff; margin: 0 0 10px 0;">
                    {% if payment.payment_method == 'cash' %}
                        üí∞ Ti·ªÅn m·∫∑t
                    {% elif payment.payment_method == 'vnpay' %}
                        üí≥ VNPay
                    {% elif payment.payment_method == 'stripe' %}
                        üè¶ Stripe
                    {% else %}
                        {{ payment.payment_method }}
                    {% endif %}
                </h4>
                <div style="font-size: 20px; font-weight: bold; color: #333;">{{ payment.total|floatformat:0 }} VNƒê</div>
                <div style="color: #666; font-size: 14px;">{{ payment.count }} giao d·ªãch</div>
            </div>
            {% empty %}
            <div style="text-align: center; color: #666; grid-column: 1 / -1;">
                Ch∆∞a c√≥ d·ªØ li·ªáu thanh to√°n
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Top kh√°ch h√†ng -->
    <div class="module" style="margin-top: 30px;">
        <h3>Top 10 Kh√°ch h√†ng VIP</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Kh√°ch h√†ng</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Email</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">S·ªë ƒëi·ªán tho·∫°i</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">T·ªïng chi ti√™u (VNƒê)</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in top_customers %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <strong>{{ customer.full_name }}</strong>
                        <br>
                        <small style="color: #666;">@{{ customer.username }}</small>
                    </td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ customer.email }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ customer.phone|default:"Ch∆∞a c√≥" }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">
                        <strong style="color: #dc3545;">{{ customer.total_spent|floatformat:0 }}</strong>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="padding: 10px; border: 1px solid #ddd; text-align: center; color: #666;">
                        Ch∆∞a c√≥ d·ªØ li·ªáu kh√°ch h√†ng
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stat-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
    }
    
    .stat-card h4 {
        color: #007bff;
        margin: 0 0 10px 0;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 10px;
        border: 1px solid #ddd;
    }
    
    th {
        background: #f8f9fa;
        font-weight: bold;
    }
    
    tr:nth-child(even) {
        background: #f9f9f9;
    }
</style>
{% endblock %}
